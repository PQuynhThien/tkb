<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKB 12A8 </title>
    <style>
        :root {
            --bg-dark: #202124;
            --border-color: #5f6368;
            --text-main: #e8eaed;
            --accent-blue: #8ab4f8;
            --keep-yellow: #fbbc04;
        }

        body { background-color: #050505; color: var(--text-main); font-family: 'Segoe UI', Arial, sans-serif; margin: 0; }

      
        #main-ui { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; }
        .led-border { padding: 3px; border-radius: 12px; background: linear-gradient(90deg, #ff0000, #00f2ff, #7a00ff, #ff0000); background-size: 300%; animation: led-run 10s linear infinite; }
        @keyframes led-run { 0% { background-position: 0% 50%; } 100% { background-position: 300% 50%; } }
        .container { background: #0f0f0f; border-radius: 10px; padding: 25px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        table { border-collapse: collapse; width: 100%; border: 1px solid #333; }
        th, td { border: 1px solid #333; padding: 10px; text-align: center; min-width: 90px; }
        th { color: var(--accent-blue); background: #1a1a1a; }

        
        #secret-page { display: none; background-color: var(--bg-dark); min-height: 100vh; flex-direction: column; align-items: center; padding-bottom: 50px; }
        .keep-nav { width: 100%; padding: 12px 25px; display: flex; align-items: center; border-bottom: 1px solid var(--border-color); background: var(--bg-dark); position: sticky; top: 0; z-index: 100; gap: 10px; }
        
        #notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; width: 95%; max-width: 1300px; margin-top: 20px; }
        
        .note-card { 
            border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; 
            cursor: pointer; transition: 0.3s; overflow: hidden; max-height: 450px; 
            position: relative; background-size: cover; background-position: center;
        }
        .note-card::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1; display: none; }
        .note-card.has-bg::before { display: block; }
        .note-card .content-wrapper { position: relative; z-index: 2; }

        
        #edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { width: 98%; max-width: 850px; border-radius: 15px; border: 1px solid var(--border-color); background: var(--bg-dark); background-size: cover; background-position: center; position: relative; overflow: hidden; }
        .modal-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1; display: none; }
        .modal-content.has-bg .modal-overlay { display: block; }
        .modal-inner { position: relative; z-index: 2; display: flex; flex-direction: column; }

        .toolbar { display: flex; flex-wrap: wrap; gap: 6px; padding: 10px; background: rgba(30, 31, 34, 0.95); border-bottom: 1px solid var(--border-color); align-items: center; }
        .tool-btn { background: #3c4043; border: 1px solid #5f6368; color: white; padding: 6px 12px; cursor: pointer; border-radius: 6px; font-size: 12px; display: flex; align-items: center; gap: 5px; }
        
        #editor-body { width: 100%; min-height: 450px; max-height: 70vh; padding: 25px; outline: none; overflow-y: auto; box-sizing: border-box; line-height: 1.6; }

        
        .time-widget { 
            display: inline-block; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); padding: 15px 20px; border-radius: 12px;
            margin: 15px 0; color: #fff; font-family: 'Courier New', monospace; text-align: center; min-width: 250px;
        }
        .time-val { font-size: 20px; font-weight: bold; color: var(--accent-blue); display: block; }
        .cl-item { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .cl-check { width: 18px; height: 18px; cursor: pointer; }
        .cl-text.done { text-decoration: line-through; opacity: 0.5; }

       
        .note-table { margin: 15px 0; font-size: 13px; }
        .note-table th { font-size: 12px; padding: 5px; }
        .note-table td { padding: 5px; background: rgba(255,255,255,0.05); }

       
        .c-default { background-color: #202124 !important; }
        .c-red { background-color: #5c2b29 !important; }
        .c-green { background-color: #345920 !important; }
        .c-blue { background-color: #2d555e !important; }
        .dot { width: 22px; height: 22px; border-radius: 50%; border: 2px solid white; cursor: pointer; margin-left: 5px; }

        .btn-ui { padding: 8px 15px; border-radius: 4px; border: 1px solid var(--border-color); background: transparent; color: var(--accent-blue); cursor: pointer; font-weight: bold; }
        .input-wrapper { width: 100%; max-width: 600px; margin-top: 30px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 8px; }
        #new-title { width: 100%; padding: 12px 15px; background: transparent; border: none; color: white; outline: none; font-weight: bold; }
    </style>
</head>
<body>

    <div id="main-ui">
        <div class="led-border"><div class="container">
            <h1 style="text-align:center; color:var(--accent-blue)">12A8 SCHEDULE</h1>
            <table>
                <thead><tr><th>Ti·∫øt</th><th>Th·ª© 2</th><th>Th·ª© 3</th><th>Th·ª© 4</th><th>Th·ª© 5</th><th>Th·ª© 6</th><th>Th·ª© 7</th></tr></thead>
                <tbody id="tkbBody"></tbody>
            </table>
        </div></div>
        <button class="btn-ui" style="margin-top:20px" onclick="saveTKB(true)">üíæ L∆ØU D·ªÆ LI·ªÜU</button>
    </div>

    <div id="secret-page">
        <nav class="keep-nav">
            <div style="flex-grow:1; font-size:22px; font-weight:bold"><span style="color:var(--accent-blue)">‚è±Ô∏è</span> N∆°i b√≠ m·∫≠t</div>
            <button class="btn-ui" style="color:#fbbc04" onclick="exportEncryptedData()">üì§ SAO L∆ØU</button>
            <button class="btn-ui" style="color:#81c995" onclick="document.getElementById('fileInput').click()">üì• KH√îI PH·ª§C</button>
            <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importEncryptedData(event)">
            <button class="btn-ui" onclick="exitSecret()">ƒê√ìNG</button>
        </nav>
        
        <div class="input-wrapper">
            <input type="text" id="new-title" placeholder="Ti√™u ƒë·ªÅ..." onclick="document.getElementById('new-body-editor').style.display='block'; document.getElementById('new-actions').style.display='flex'">
            <div id="new-body-editor" contenteditable="true" style="display:none; padding:12px 15px; outline:none; border-top:1px solid #444"></div>
            <div id="new-actions" style="display:none; padding:10px; justify-content:flex-end;"><button class="btn-ui" onclick="addNote()">Xong</button></div>
        </div>
        <div id="notes-grid"></div>
    </div>

    <div id="edit-modal"><div class="modal-content" id="modal-box">
        <div class="modal-overlay"></div>
        <div class="modal-inner">
            <div class="toolbar">
                <button class="tool-btn" onclick="execCmd('bold')">B</button>
                <button class="tool-btn" onclick="insertChecklist()">‚úÖ Checklist</button>
                <button class="tool-btn" style="color: #fbbc04" onclick="insertTableWidget()">üìÖ B·∫£ng TKB</button>
                <button class="tool-btn" style="color: #8ab4f8" onclick="insertTimeWidget('DOWN')">‚è≥ ƒê·∫øm Ng∆∞·ª£c</button>
                <button class="tool-btn" onclick="document.getElementById('colorPicker').click()">üé® M√†u <input type="color" id="colorPicker" style="display:none" onchange="execCmd('foreColor', this.value)"></button>
                <button class="tool-btn" onclick="document.getElementById('imgInput').click()">üñº ·∫¢nh</button>
                <button class="tool-btn" onclick="document.getElementById('themeImgInput').click()">üåÑ N·ªÅn</button>
                <input type="file" id="imgInput" style="display:none" accept="image/*" onchange="handleImage(event)">
                <input type="file" id="themeImgInput" style="display:none" accept="image/*" onchange="handleThemeImage(event)">
                <div style="flex-grow:1"></div>
                <div id="theme-dots" style="display:flex"></div>
            </div>
            <input type="text" id="editor-title" placeholder="Ti√™u ƒë·ªÅ" style="width:100%; background:transparent; border:none; color:white; padding:15px; font-size:1.2em; outline:none; font-weight:bold">
            <div id="editor-body" contenteditable="true"></div>
            <div style="padding:15px; text-align:right; border-top:1px solid #444; display:flex; justify-content:space-between">
                <button class="btn-ui" style="color:#ff4d4d" onclick="deleteNote()">üóë X√≥a</button>
                <button class="btn-ui" style="background:var(--accent-blue); color:black" onclick="closeEdit()">L∆∞u & ƒê√≥ng</button>
            </div>
        </div>
    </div></div>

    <script>
        const _0xPASS = [0x54, 0x68, 0x69, 0xe1, 0xbb, 0x87, 0x6e, 0x20, 0x64, 0x7a];
        let notes = JSON.parse(localStorage.getItem('_master_notes')) || [];
        let currentId = null;

        function init() {
            const tbody = document.getElementById('tkbBody');
            const data = JSON.parse(localStorage.getItem('_tkb_data')) || [["1","SHDC","HDTN","QP","L√Ω","To√°n","TD"],["2","Anh","H√≥a","GD","S·ª≠","To√°n","H√≥a"],["3","H√≥a","L√Ω","VƒÉn","","TD","Anh"],["4","VƒÉn","GD","To√°n","","Tin","Anh"],["5","VƒÉn","Tin","To√°n","","L√Ω","SHL"]];
            tbody.innerHTML = "";
            data.forEach((row, rIdx) => {
                let tr = document.createElement('tr');
                row.forEach((cell, cIdx) => {
                    let td = document.createElement('td'); td.innerText = cell;
                    if (cIdx !== 0) td.contentEditable = "true";
                    if (rIdx === 3 && cIdx === 4) { 
                        td.id = "v-key"; 
                        td.addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); unlock(); } }); 
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            setupThemeDots(); renderNotes();
            setInterval(updateAllTimeWidgets, 1000);
        }

        function unlock() {
            const secret = new TextDecoder().decode(new Uint8Array(_0xPASS));
            const input = document.getElementById('v-key').innerText.trim();
            if (input === secret) {
                document.getElementById('v-key').innerText = "";
                document.getElementById('main-ui').style.display = 'none';
                document.getElementById('secret-page').style.display = 'flex';
            } else { 
                saveTKB(true); 
            }
        }

        function execCmd(cmd, val = null) { document.execCommand(cmd, false, val); }

        function insertChecklist() {
            const html = `<div class="cl-item" contenteditable="false"><input type="checkbox" class="cl-check" onchange="this.nextElementSibling.classList.toggle('done', this.checked)"><div class="cl-text" contenteditable="true">Vi·ªác m·ªõi...</div></div><p><br></p>`;
            execCmd('insertHTML', html);
        }

        // CH·ª®C NƒÇNG M·ªöI: CH√àN B·∫¢NG TKB
        function insertTableWidget() {
            let tableHTML = `<table class="note-table" contenteditable="true">
                <thead><tr><th>Ti·∫øt</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr></thead>
                <tbody>
                    ${[1,2,3,4,5].map(i => `<tr><td>${i}</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>`).join('')}
                </tbody>
            </table><p><br></p>`;
            execCmd('insertHTML', tableHTML);
        }

        function insertTimeWidget(type) {
            const dateStr = prompt("Ch·ªçn m·ªëc th·ªùi gian (YYYY-MM-DD HH:MM:SS):", "2026-06-25 00:00:00");
            if (!dateStr) return;
            const html = `<div class="time-widget" data-date="${dateStr}" contenteditable="false"><span class="time-val">...</span><span class="time-label">ƒê·∫øn: ${dateStr}</span></div><p><br></p>`;
            execCmd('insertHTML', html);
        }

        function updateAllTimeWidgets() {
            document.querySelectorAll('.time-widget').forEach(el => {
                const target = new Date(el.dataset.date).getTime();
                const now = new Date().getTime();
                const diff = target - now;
                if (diff <= 0) { el.querySelector('.time-val').innerText = "D-DAY!"; return; }
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                el.querySelector('.time-val').innerText = `${d}d ${h.toString().padStart(2,'0')}h ${m.toString().padStart(2,'0')}m ${s.toString().padStart(2,'0')}s`;
            });
        }

        function handleImage(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = ev => execCmd('insertHTML', `<img src="${ev.target.result}" style="max-width:100%; border-radius:8px"><p><br></p>`);
                reader.readAsDataURL(file);
            }
        }

        function handleThemeImage(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = ev => {
                    const n = notes.find(x => x.id === currentId);
                    n.bgImg = ev.target.result;
                    applyTheme(null, ev.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function applyTheme(colorCls, bgImg) {
            const box = document.getElementById('modal-box');
            if (bgImg) { box.style.backgroundImage = `url(${bgImg})`; box.className = 'modal-content has-bg'; } 
            else { box.style.backgroundImage = ''; box.className = `modal-content ${colorCls || 'c-default'}`; }
        }

        function renderNotes() {
            const grid = document.getElementById('notes-grid'); grid.innerHTML = "";
            notes.forEach(n => {
                const card = document.createElement('div');
                card.className = `note-card ${n.bgImg ? 'has-bg' : (n.color || 'c-default')}`;
                if (n.bgImg) card.style.backgroundImage = `url(${n.bgImg})`;
                card.onclick = () => openEdit(n.id);
                // Gi·ªõi h·∫°n hi·ªÉn th·ªã n·ªôi dung ƒë·ªÉ kh√¥ng b·ªã tr√†n card
                card.innerHTML = `<div class="content-wrapper"><div style="font-weight:bold; margin-bottom:8px">${n.title || 'Note'}</div><div style="font-size:13px; max-height:120px; overflow:hidden">${n.body}</div></div>`;
                grid.appendChild(card);
            });
        }

        function openEdit(id) { 
            currentId = id; const n = notes.find(x => x.id === id); 
            document.getElementById('editor-title').value = n.title; 
            document.getElementById('editor-body').innerHTML = n.body; 
            applyTheme(n.color, n.bgImg);
            document.getElementById('edit-modal').style.display = 'flex'; 
        }

        function closeEdit() {
            const n = notes.find(x => x.id === currentId);
            // L∆∞u tr·∫°ng th√°i checkbox
            document.querySelectorAll('.cl-check').forEach(cb => {
                if(cb.checked) cb.setAttribute('checked', 'true');
                else cb.removeAttribute('checked');
            });
            n.title = document.getElementById('editor-title').value;
            n.body = document.getElementById('editor-body').innerHTML;
            save(); document.getElementById('edit-modal').style.display = 'none';
        }

        function save() { localStorage.setItem('_master_notes', JSON.stringify(notes)); renderNotes(); }
        function saveTKB(eff) { localStorage.setItem('_tkb_data', JSON.stringify(Array.from(document.querySelectorAll('#tkbBody tr')).map(r => Array.from(r.querySelectorAll('td')).map(td => td.innerText)))); if(eff) alert("ƒê√£ l∆∞u TKB!"); }
        function addNote() {
            const t = document.getElementById('new-title').value, b = document.getElementById('new-body-editor').innerHTML;
            if(t || b) {
                notes.unshift({ id: Date.now(), title: t, body: b, color: 'c-default', bgImg: null });
                save(); document.getElementById('new-title').value = ""; document.getElementById('new-body-editor').innerHTML = ""; document.getElementById('new-body-editor').style.display = 'none';
            }
        }

        function deleteNote() { if(confirm("X√≥a?")) { notes = notes.filter(x => x.id !== currentId); save(); document.getElementById('edit-modal').style.display = 'none'; } }
        function exitSecret() { document.getElementById('secret-page').style.display='none'; document.getElementById('main-ui').style.display='flex'; }
        
        function setupThemeDots() {
            const container = document.getElementById('theme-dots');
            ['c-default', 'c-red', 'c-green', 'c-blue'].forEach(cls => {
                const d = document.createElement('div'); d.className = `dot ${cls}`;
                d.onclick = () => { const n = notes.find(x => x.id === currentId); n.color = cls; n.bgImg = null; applyTheme(cls, null); };
                container.appendChild(d);
            });
        }

        function encrypt(t) { return btoa(unescape(encodeURIComponent(t))).split("").reverse().join(""); }
        function decrypt(c) { try { return decodeURIComponent(escape(atob(c.split("").reverse().join("")))); } catch(e) { return "{}"; } }
        function exportEncryptedData() {
            const data = encrypt(JSON.stringify({ tkb: JSON.parse(localStorage.getItem('_tkb_data')), notes: notes }));
            const blob = new Blob([JSON.stringify({ vault_payload: data })], { type: 'application/json' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `CyberVault_Fixed.json`; a.click();
        }
        function importEncryptedData(e) {
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const res = JSON.parse(decrypt(JSON.parse(ev.target.result).vault_payload));
                    if(confirm("Restore?")) { localStorage.setItem('_tkb_data', JSON.stringify(res.tkb)); notes = res.notes; save(); location.reload(); }
                } catch(err) { alert("Error!"); }
            };
            reader.readAsText(e.target.files[0]);
        }

        window.onload = init;
    </script>
</body>
</html>
